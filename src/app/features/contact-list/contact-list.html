<div class="contact-list-container">
  <app-header title="Contacts" />

  @if (!isOnline()) {
  <div class="offline-banner">
    <span class="offline-icon">ğŸ“´</span>
    <span class="offline-text">You're offline. Showing cached contacts.</span>
  </div>
  }

  <div class="search-action-combined">
    @if (contacts().length > 0) {
    <div class="search-input-wrapper">
      <span class="search-icon">ğŸ”</span>
      <input type="text" class="search-input" placeholder="Search contacts" [value]="searchInput()"
        (input)="onSearchChange($any($event.target).value)">
      @if (searchInput()) {
      <button class="search-clear" (click)="clearSearch()" title="Clear search">
        âœ•
      </button>
      }
    </div>

    <div class="contact-count-section">
      @if (searchInput()) {
      <span class="contact-count-text">
        {{ filteredContacts().length }} of {{ contacts().length }} contact{{ contacts().length > 1 ? 's' : '' }}
      </span>
      } @else {
      <span class="contact-count-text">
        {{ contacts().length }} contact{{ contacts().length > 1 ? 's' : '' }}
      </span>
      }
    </div>
    }

    <div class="action-buttons">
      <button class="btn btn-primary" (click)="onNewContact()">
        <span class="btn-icon">â•</span>
        <span class="btn-text">Add New Contact</span>
      </button>
      <button class="btn btn-secondary" (click)="onAddRandomContacts()"
        [disabled]="!isOnline() || isAddingRandomContacts()">
        <span class="btn-icon">ğŸ²</span>
        <span class="btn-text">
          @if (isAddingRandomContacts()) {
          Adding...
          } @else {
          Add Random Contacts
          }
        </span>
      </button>
    </div>
  </div>

  <div class="action-bar-mobile">
    <div class="mobile-button-row">
      <button class="btn btn-primary" (click)="onNewContact()">
        <span class="btn-icon">â•</span>
        <span class="btn-text">Add New Contact</span>
      </button>
    </div>
    <div class="mobile-button-row">
      <button class="btn btn-secondary" (click)="onAddRandomContacts()" [disabled]="isAddingRandomContacts()">
        <span class="btn-icon">ğŸ²</span>
        <span class="btn-text">
          @if (isAddingRandomContacts()) {
          Adding...
          } @else {
          Add Random Contacts
          }
        </span>
      </button>
    </div>
  </div>

  @if (loading()) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <span class="loading-text">Loading contacts...</span>
  </div>
  }

  @if (!loading() && contacts().length === 0) {
  <div class="empty-state">
    <div class="empty-icon">ğŸ‘¥</div>
    @if (isOnline()) {
    <h2 class="empty-title">No Contacts Yet</h2>
    <p class="empty-message">
      Get started by creating your first contact or adding some random sample contacts.
    </p>
    } @else {
    <h2 class="empty-title">No Contacts Available</h2>
    <p class="empty-message">
      You're currently offline and no contacts are cached. Connect to the internet to load your contacts.
    </p>
    <div class="empty-actions">
      <button class="btn btn-primary" (click)="onNewContact()">
        Create Contact (will sync later)
      </button>
    </div>
    }
  </div>
  }

  @if (!loading() && contacts().length > 0 && searchInput() && filteredContacts().length === 0) {
  <div class="empty-state">
    <div class="empty-icon">ğŸ”</div>
    <h2 class="empty-title">No Results Found</h2>
    <p class="empty-message">
      No contacts match your search for "<strong>{{ searchInput() }}</strong>".
      <br>Try searching with a different term.
    </p>
    <div class="empty-actions">
      <button class="btn btn-outline" (click)="clearSearch()">
        Clear Search
      </button>
    </div>
  </div>
  }

  @if (filteredContacts().length > 0) {
  <div class="contact-grid">
    @for (contact of filteredContacts(); track trackByContactId($index, contact)) {
    <div class="contact-card" [class.pending-sync]="contact.pendingSync" (click)="onContactClick(contact)">
      <div class="contact-avatar">
        @if (getContactImageSrc(contact)) {
        <img [src]="getContactImageSrc(contact)" [alt]="getContactFullName(contact)" class="avatar-image"
          (error)="onImageError(contact)" loading="lazy">
        } @else {
        <div class="avatar-placeholder" [class.offline-avatar]="!isOnline()">
          {{ getContactFullName(contact).charAt(0).toUpperCase() }}
        </div>
        }
        @if (contact.isFavorite) {
        <div class="favorite-indicator" title="Click to remove from favorites"
          (click)="onToggleFavorite(contact, $event)">â­</div>
        } @else {
        <div class="favorite-indicator unfavorite" title="Click to add to favorites"
          (click)="onToggleFavorite(contact, $event)">â˜†</div>
        }
        @if (contact.pendingSync) {
        <div class="sync-indicator" title="Pending sync">â³</div>
        }
      </div>

      <div class="contact-info">
        <h3 class="contact-name">{{ getContactFullName(contact) }}</h3>
        <div class="contact-details">
          @if (contact.email) {
          <div class="contact-detail">
            <span class="detail-icon">ğŸ“§</span>
            <span class="detail-text">{{ contact.email }}</span>
          </div>
          }
          @if (contact.phone) {
          <div class="contact-detail">
            <span class="detail-icon">ğŸ“±</span>
            <span class="detail-text">{{ contact.phone }}</span>
          </div>
          }
          @if (contact.location) {
          <div class="contact-detail">
            <span class="detail-icon">ğŸ“</span>
            <span class="detail-text">{{ contact.location.city }}, {{ contact.location.state }}</span>
          </div>
          }
          @if (contact.dob && contact.dob.age) {
          <div class="contact-detail">
            <span class="detail-icon">ğŸ‚</span>
            <span class="detail-text">{{ contact.dob.age }} years old</span>
          </div>
          }
        </div>
      </div>
    </div>
    }
  </div>
  }
</div>

<button class="fab" (click)="onNewContact()" title="Create new contact" aria-label="Create new contact">
  <span class="fab-icon">â•</span>
</button>